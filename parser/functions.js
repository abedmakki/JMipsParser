function DoParse(){labelStack=[];allLine="";labelGoto=[];labelToChecked=[];orgstack=[];matStack=[];document.getElementById("assembResult").innerHTML="";var e=document.getElementById("code").value;var t=e.split("\n");var n=0;for(n=0;n<t.length;n++){if(t[n]=="")continue;try{var r=parser.parse(t[n])}catch(i){alert(i);return}if(r==false)return false;allLine+=r.vals}if(checkGotoLabels()){return false}document.getElementById("assembResult").innerHTML+=allLine;document.getElementById("assembResult").innerHTML+="\nHLT\n";for(n=0;n<labelStack.length;n++)document.getElementById("assembResult").innerHTML+=labelStack[n].label+", "+labelStack[n].value+"\n";if(orgstack[0]!=null&&orgstack[0]!="undefined"&&orgstack[0]!=undefined)for(n=0;n<orgstack.length;n++){document.getElementById("assembResult").innerHTML+="\nORG "+orgstack[n].ORG;for(var s=orgstack[n].ORG;s<orgstack[n].LAST;s++)document.getElementById("assembResult").innerHTML+="\nDEC 0"}document.getElementById("assembResult").innerHTML+="\nEND";return true}function createLabel(){var e="ABCDEFGHIJKLMNOPQRSTUVWXTZ";var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";var n=2;var r="";var i=true;while(i){for(var s=0;s<n;s++){var o=Math.floor(Math.random()*e.length);r+=e.substring(o,o+1)}o=Math.floor(Math.random()*t.length);r+=t.substring(o,o+1);if(searchlbl(r,labelStack)==null){i=false}}return r}function checkGotoLabels(){for(var e=0;e<labelToChecked.length;e++){if(labelToChecked[e].varname!=undefined){var t=labelToChecked[e].varname;var n=searchvarlbl(labelToChecked[e].varname,labelGoto)}else{n=searchlbl(labelToChecked[e].label,labelGoto);t=labelToChecked[e].label}if(n!=null)labelToChecked[e].status=true;else{alert("Error... Label: "+t+" is not defined");return true}}return false}function searchlbl(e,t){for(var n=0;n<t.length;n++){if(t[n].label===e){return{ob:t[n],i:n}}}return null}function searchNumlbl(e,t){for(var n=0;n<t.length;n++){if(t[n].value==="DEC "+e){return{ob:t[n],i:n}}}return null}function searchvarlbl(e,t){for(var n=0;n<t.length;n++){if(t[n].varname===e){return{ob:t[n],i:n}}}return null}function searchInitlbl(e,t){for(var n=0;n<t.length;n++){if(t[n].status===e){return{ob:t[n],i:n}}}return null}function numb(e){if(e==0){var t=searchInitlbl("intial",labelStack);if(t!=null)return{label:t.ob.label,status:true};var n=createLabel();labelStack.push({label:n,value:"DEC "+e});return{label:n,status:true}}else{var r=searchNumlbl(e,labelStack);if(r!=null)return{label:r.ob.label,status:true};n=createLabel();labelStack.push({label:n,value:"DEC "+e});return{label:n,status:true}}}function minnumb(e){var t=searchNumlbl(-e,labelStack);if(t!=null)return{label:t.ob.label,status:true};var n=createLabel();labelStack.push({label:n,value:"DEC -"+e});return{label:n,status:true}}function minID(e){if(e.length>3){var t=searchvarlbl(e,labelStack);if(t!=null)return{label:t.ob.label,status:"min"};var n=createLabel();return{label:n,status:false,varname:e}}t=searchlbl(e,labelStack);if(t!=null){t=t.ob;return{label:t.label,status:"min"}}else{return{label:e,status:false}}}function idd(e){if(e.length>3){var t=searchvarlbl(e,labelStack);if(t!=null)return{label:t.ob.label,status:true,varname:e};var n=createLabel();return{label:n,status:false,varname:e}}if((t=searchvarlbl(e,labelStack))!=null)return{label:t.ob.label,status:true,varname:e};else if((t=searchlbl(e,labelGoto))!=null){n=createLabel();return{label:n,status:false,varname:e}}else if((t=searchlbl(e,labelToChecked))!=null){n=createLabel();return{label:n,status:false,varname:e}}t=searchlbl(e,labelStack);if(t!=null){t=t.ob;return{label:t.label,status:true}}else{return{label:e,status:false}}}function equlnew(e,t){if(e==false||t==false)return false;var n="";if(t.status==true)n=n+"LDA "+t.label+"\n";else if(t.status=="op")n=n+t.vals;else if(t.status=="min")n=n+"LDA "+t.label+"\nCMA\nINC\n";else{if(t.varname!=undefined)alert("Error... "+t.varname+" is not initialize");else{alert("Error... "+t.label+" is not initialize")}return false}if(e.status)n=n+"STA "+e.label+"\n";else{if(e.varname!=undefined)labelStack.push({label:e.label,value:"DEC "+0,varname:e.varname});else{labelStack.push({label:e.label,value:"DEC "+0})}n=n+"STA "+e.label+"\n"}return{vals:n}}function adderop(e,t){var n="";if(t.status)n=n+"LDA "+t.label+"\n";else{if(t.varname!=undefined)alert("Error... "+t.varname+" is not initialize");else{alert("Error... "+t.label+" is not initialize")}return false}if(e.status==true)n=n+"ADD "+e.label+"\n";else if(e.status=="min"){var r=createLabel();labelStack.push({label:r,value:"DEC "+0});n="LDA "+e.label+"\nCMA\nINC\nSTA "+r+"\n"+n;n=n+"ADD "+r+"\n"}else{if(e.varname!=undefined)alert("Error... "+e.varname+" is not initialize");return false;alert("Error... "+e.label+" is not initialize");return false}return{vals:n,status:"op"}}function suberop(e,t){var n="";if(t.status){n=n+"LDA "+t.label+"\n";n=n+"CMA\nINC\n"}else{if(t.varname!=undefined)alert("Error... "+t.varname+" is not initialize");else{alert("Error... "+t.label+" is not initialize")}return false}if(e.status==true)n=n+"ADD "+e.label+"\n";else if(e.status=="min"){var r=createLabel();labelStack.push({label:r,value:"DEC "+0});n="LDA "+e.label+"\nCMA\nINC\nSTA "+r+"\n"+n;n=n+"ADD "+r+"\n"}else{if(e.varname!=undefined)alert("Error... "+e.varname+" is not initialize");else{alert("Error... "+e.label+" is not initialize")}return false}return{vals:n,status:"op"}}function gotofn(e){var t="";if(e.length>3){var n=searchvarlbl(e,labelGoto);if(n!=null){t+="BUN "+n.ob.label+"\n";n=searchvarlbl(e,labelToChecked);if(n!=null)labelToChecked.splice(n.i,1)}else{var r=createLabel();labelToChecked.push({label:r,status:false,varname:e});t+="BUN "+r+"\n"}return{vals:t}}n=searchlbl(e,labelGoto);if(n!=null){n=searchlbl(e,labelToChecked);if(n!=null)labelToChecked.splice(n.i,1);t+="BUN "+e+"\n"}else{if((n=searchlbl(e,labelStack))!=null){if((n=searchvarlbl(e,labelGoto))!=null){t+="BUN "+n.ob.label+"\n"}else{r=createLabel();t+="BUN "+r+"\n";labelToChecked.push({label:r,status:false,varname:e})}}else{t+="BUN "+e+"\n";labelToChecked.push({label:e,status:false})}}return{vals:t}}function ifstmnt(e,t,n,r){var i=searchlbl(r,labelGoto);if(i!=null){i=searchlbl(r,labelToChecked);if(i!=null)labelToChecked.splice(i.i,1)}else{labelToChecked.push({label:r,status:false})}var s="";switch(n){case">":case">=":if(t.status&&e.status){s+="LDA "+t.label+"\nCMA\nINC\nADD "+e.label+"\nSNA\nBUN "+r+"\n";if(n==">")s+="SZA\nBUN "+r+"\n"}else{alert("Error... Label not init");return false}break;case"<":case"<=":if(t.status&&e.status){s+="LDA "+t.label+"\nCMA\nINC\nADD "+e.label+"\nSPA\nBUN "+r+"\n";if(n=="<")s+="SZA\nBUN "+r+"\n"}else{alert("Error... Label not init");return false}break;case"==":if(t.status&&e.status){s+="LDA "+t.label+"\nCMA\nINC\nADD "+e.label+"\nSZA\nBUN "+r+"\n"}else{alert("Error... Label not init");return false}break}return{vals:s}}function lbfun(e,t){if(e.length>3){var n="";var r=searchvarlbl(e,labelGoto);if(r!=null){alert("Error... Label : "+r.ob.label+" are double defined!");return false}else if((r=searchvarlbl(e,labelToChecked))!=null){labelGoto.push({label:r.ob.label,status:true,varname:e});labelToChecked.splice(r.i,1);n=r.ob.label}else{var i=createLabel();labelGoto.push({label:i,status:true,varname:e});n=i}if(t.status=="int"){var s=createLabel();labelStack.push({label:s,value:"DEC "+0,status:"intial"});return{vals:n+", LDA "+s+"\nSTA "+t.label+"\n"}}else return{vals:n+", "+t.vals}}r=searchlbl(e,labelGoto);if(r!=null){r=r.ob;alert("Error... Label : "+r.label+" are double defined!");return false}else if((r=searchvarlbl(e,labelToChecked))!=null){labelGoto.push({label:r.ob.label,status:true,varname:e});labelToChecked.splice(r.i,1);return{vals:r.ob.label+", "+t.vals}}else{if((r=searchlbl(e,labelStack))!=null){if((r=searchlbl(e,labelToChecked))!=null){labelGoto.push({label:r.ob.label,status:true,varname:e});labelToChecked.splice(r.i,1);return{vals:r.ob.label+", "+t.vals}}i=createLabel();labelGoto.push({label:i,status:true,varname:e});return{vals:i+", "+t.vals}}labelGoto.push({label:e,status:true});if(t.status=="int"){i=createLabel();labelStack.push({label:i,value:"DEC "+0,status:"intial"});return{vals:e+", LDA "+i+"\nSTA "+t.label+"\n"}}else return{vals:e+", "+t.vals}}}function initvar(e){if(e.length>3){var t=searchvarlbl(e,labelStack);if(t!=null){alert("Warning: Variable "+e.varname+" has aleardy initialized")}else{var n=createLabel();labelStack.push({label:n,value:"DEC "+0,varname:e})}return{vals:"",status:"int",label:n}}t=searchlbl(e,labelStack);if(t!=null)alert("Warning: Variable "+e+" has aleardy initialized");else{labelStack.push({label:e,value:"DEC "+0})}return{vals:"",status:"int",label:e}}function initvarMat(e,t){if(e.length>3){var n=searchvarlbl(e,labelStack);if(n!=null){alert("warning...");return false;e=n.ob.label;var r=n.ob.varname}else{var i=createLabel();r=e;e=i}}else{if((n=searchlbl(e,labelStack))!=null){alert("warning...");return false;e=n.ob.label;r=undefined}else{e=e;r=undefined}}if(orgstack[0]!=null&&orgstack[0]!="undefined"&&orgstack[0]!=undefined){var s=orgstack[orgstack.length-1].LAST;orgstack.push({ORG:s,LAST:s+t});labelStack.push({label:e,value:"HEX "+s,varname:r})}else{s=400;orgstack.push({ORG:s,LAST:s+t});labelStack.push({label:e,value:"HEX "+s,varname:r})}matStack.push({label:e,numb:t});return{vals:"",status:"int"}}function eqMatrix(e,t,n){var r="";var i=null;i=searchlbl(t,matStack);if(i.ob.numb<n||n==0){alert("Error... out of matrix");return false}n=numb(n);if(t.length>3){if((i=searchvarlbl(t,labelStack))!=null){r+="LDA "+i.ob.label+"\nADD "+n.label+"\n";if(e.length>3){if((i=searchvarlbl(e,labelStack))!=null){r+="STA "+i.ob.label+"\nLDA "+i.ob.label+" I\nSTA "+i.ob.label+"\n"}else{var s=createLabel();labelStack.push({label:s,value:"DEC "+0,varname:t});r+="STA "+s+"\nLDA "+s+" I\nSTA "+s+"\n"}}else{if((i=searchlbl(e,labelStack))!=null){r+="STA "+i.ob.label+"\nLDA "+i.ob.label+" I\nSTA "+i.ob.label+"\n"}else{labelStack.push({label:e,value:"DEC "+0});r+="STA "+e+"\nLDA "+e+" I\nSTA "+e+"\n"}}}else{alert("Error... Matrix: "+t.varname+" is not defined");return false}}else{if((i=searchlbl(t,labelStack))!=null){r+="LDA "+i.ob.label+"\nADD "+n.label+"\n";if(e.length>3){if((i=searchvarlbl(e,labelStack))!=null){r+="STA "+i.ob.label+"\nLDA "+i.ob.label+" I\nSTA "+i.ob.label+"\n"}else{s=createLabel();labelStack.push({label:s,value:"DEC "+0,varname:t});r+="STA "+s+"\nLDA "+s+" I\nSTA "+s+"\n"}}else{if((i=searchlbl(e,labelStack))!=null){r+="STA "+i.ob.label+"\nLDA "+i.ob.label+" I\nSTA "+i.ob.label+"\n"}else{labelStack.push({label:e,value:"DEC "+0});r+="STA "+e+"\nLDA "+e+" I\nSTA "+e+"\n"}}}else{alert("Error... Matrix: "+t+" is not defined");return false}}return{vals:r}}var allLine="";var labelStack=[];var labelGoto=[],labelToChecked=[];var orgstack=[];var matStack=[]
